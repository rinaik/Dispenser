#include "gui.h"

#include "stm32f429i_discovery_ts.h"  // touch-screen header
#include "stm32f429i_discovery_lcd.h" // lcd header

//Notes: Screen Size: 240x320

void LCDInit()
{
	  BSP_LCD_Init();
	  BSP_TS_Init(240,360);

	  BSP_LCD_LayerDefaultInit(1,SDRAM_DEVICE_ADDR);
	  BSP_LCD_SelectLayer(1);

	  BSP_LCD_DisplayOn();

}

void window_1_callback (UG_MESSAGE* msg)
{
    if (msg->type == MSG_TYPE_OBJECT )
    {
    	if (msg->id == OBJ_TYPE_BUTTON )
    	{
    		if (msg->sub_id == BTN_ID_0)
    		{
    		   if (msg->event == OBJ_EVENT_PRESSED) {
    		     UG_ButtonSetText(&window_1, BTN_ID_0, "PRESS!");
    		   }
    		   else {
    			   UG_ButtonSetText(&window_1, BTN_ID_0, "START");
    		   }
    		}
    		if (msg->sub_id == BTN_ID_1)
    		{
    		   UG_ButtonSetText(&window_1, BTN_ID_1, "PRESS!");
    		}
    		if (msg->sub_id == BTN_ID_2)
    		{
    		   UG_ButtonSetText(&window_1, BTN_ID_2, "PRESS!");
    		}
    		if (msg->sub_id == BTN_ID_3)
    		{
    			UG_ButtonSetText(&window_1, BTN_ID_3, "PRESS!");
    		}
    	}
    }
}

void GUIInit()
{
	 // Create a window

	          UG_WindowCreate(&window_1, obj_buff_wnd_1, MAX_OBJECTS, window_1_callback);

	          // Modify the window title

	          UG_WindowSetTitleText(&window_1,"Motor Control");
	          UG_WindowSetTitleTextFont(&window_1, &FONT_12X20);

	          // Change window fore and back color
	          UG_WindowSetForeColor(&window_1, C_WHITE);
	          UG_WindowSetBackColor(&window_1, C_BLUE);

	          // Create some buttons
	          UG_ButtonCreate(&window_1, &button_1, BTN_ID_0, 10, 10, 110, 60);
	          UG_ButtonCreate(&window_1, &button_2, BTN_ID_1, 10, 80, 110, 130);
	          UG_ButtonCreate(&window_1, &button_3, BTN_ID_2, 10, 150, 110, 200);
	          UG_ButtonCreate(&window_1, &button_4, BTN_ID_3, 10, 220, 110, 270);

	          // Label the buttons
	          UG_ButtonSetForeColor(&window_1, BTN_ID_0, C_GREEN);
	          UG_ButtonSetForeColor(&window_1, BTN_ID_1, C_RED);
	          UG_ButtonSetForeColor(&window_1, BTN_ID_2, C_BLACK);
	          UG_ButtonSetForeColor(&window_1, BTN_ID_3, C_BLACK);

	          UG_ButtonSetFont ( &window_1, BTN_ID_0, &FONT_12X20);
	          UG_ButtonSetText ( &window_1, BTN_ID_0, "START");
	          UG_ButtonSetFont ( &window_1, BTN_ID_1, &FONT_12X20);
	          UG_ButtonSetText ( &window_1, BTN_ID_1, "STOP");
	          UG_ButtonSetFont ( &window_1, BTN_ID_2, &FONT_12X20);
	          UG_ButtonSetText ( &window_1, BTN_ID_2, "REV");
	          UG_ButtonSetFont ( &window_1, BTN_ID_3, &FONT_12X20);
	          UG_ButtonSetText ( &window_1, BTN_ID_3, "FWD");

	          //  Create Textboxs

	          UG_TextboxCreate( &window_1 , &textbox_1 , TXB_ID_0 , 110 , 10 , 200 , 60 );
	          UG_TextboxSetFont ( &window_1 , TXB_ID_0 , &FONT_12X20 ) ;
	          UG_TextboxSetText ( &window_1 , TXB_ID_0, "SPEED:" );
	          UG_TextboxSetAlignment ( &window_1 , TXB_ID_0 , ALIGN_CENTER );


	          UG_TextboxCreate( &window_1 , &textbox_2 , TXB_ID_1 , 110 , 80 , 200 , 130 );
	          UG_TextboxSetFont ( &window_1 , TXB_ID_1 , &FONT_12X20 ) ;
	          UG_TextboxSetText ( &window_1 , TXB_ID_1, "1000" );
	          UG_TextboxSetAlignment ( &window_1 , TXB_ID_1 , ALIGN_CENTER );


              UG_WindowShow(&window_1);
}


void UserPixelSet(UG_S16 x, UG_S16 y, UG_COLOR c) {BSP_LCD_DrawPixel(x, y, c);}

void TouchPress(void) {
	TS_StateTypeDef TS_State;

	BSP_TS_GetState(&TS_State);
	if ( TS_State.TouchDetected ) {
		UG_TouchUpdate(TS_State.X, TS_State.Y, TOUCH_STATE_PRESSED);
		}
	else {
		UG_TouchUpdate( -1, -1, TOUCH_STATE_RELEASED);
	}
}





